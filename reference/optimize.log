# Starting form a working version

hadoop jar AccessLogMR.jar AccessLogMR log-analyser/sample log-analyser/daily
2018-04-14 14:32:48,519 INFO client.RMProxy: Connecting to ResourceManager at /0.0.0.0:8032
2018-04-14 14:32:49,067 INFO mapreduce.JobResourceUploader: Disabling Erasure Coding for path: /tmp/hadoop-yarn/staging/ubuntu/.staging/job_1523740562725_0003
2018-04-14 14:32:49,721 INFO input.FileInputFormat: Total input files to process : 1
2018-04-14 14:32:49,789 INFO mapreduce.JobSubmitter: number of splits:15
2018-04-14 14:32:49,830 INFO Configuration.deprecation: yarn.resourcemanager.system-metrics-publisher.enabled is deprecated. Instead, use yarn.system-metrics-publisher.enabled
2018-04-14 14:32:50,400 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1523740562725_0003
2018-04-14 14:32:50,402 INFO mapreduce.JobSubmitter: Executing with tokens: []
2018-04-14 14:32:50,650 INFO conf.Configuration: resource-types.xml not found
2018-04-14 14:32:50,650 INFO resource.ResourceUtils: Unable to find 'resource-types.xml'.
2018-04-14 14:32:50,729 INFO impl.YarnClientImpl: Submitted application application_1523740562725_0003
2018-04-14 14:32:50,776 INFO mapreduce.Job: The url to track the job: http://ip-172-31-25-109.us-west-2.compute.internal:8088/proxy/application_1523740562725_0003/
2018-04-14 14:32:50,777 INFO mapreduce.Job: Running job: job_1523740562725_0003
2018-04-14 14:32:58,004 INFO mapreduce.Job: Job job_1523740562725_0003 running in uber mode : false
2018-04-14 14:32:58,005 INFO mapreduce.Job:  map 0% reduce 0%
2018-04-14 14:33:09,139 INFO mapreduce.Job:  map 7% reduce 0%
2018-04-14 14:33:17,209 INFO mapreduce.Job:  map 13% reduce 0%
2018-04-14 14:33:26,284 INFO mapreduce.Job:  map 20% reduce 0%
2018-04-14 14:33:36,358 INFO mapreduce.Job:  map 27% reduce 0%
2018-04-14 14:33:45,427 INFO mapreduce.Job:  map 33% reduce 0%
2018-04-14 14:33:54,473 INFO mapreduce.Job:  map 40% reduce 0%
2018-04-14 14:34:04,542 INFO mapreduce.Job:  map 47% reduce 0%
2018-04-14 14:34:13,591 INFO mapreduce.Job:  map 53% reduce 0%
2018-04-14 14:34:22,641 INFO mapreduce.Job:  map 60% reduce 0%
2018-04-14 14:34:32,697 INFO mapreduce.Job:  map 67% reduce 0%
2018-04-14 14:34:41,745 INFO mapreduce.Job:  map 73% reduce 0%
2018-04-14 14:34:51,808 INFO mapreduce.Job:  map 80% reduce 0%
2018-04-14 14:35:00,858 INFO mapreduce.Job:  map 87% reduce 0%
2018-04-14 14:35:09,914 INFO mapreduce.Job:  map 93% reduce 0%
2018-04-14 14:35:14,942 INFO mapreduce.Job:  map 100% reduce 0%
2018-04-14 14:35:19,969 INFO mapreduce.Job:  map 100% reduce 100%
2018-04-14 14:35:20,977 INFO mapreduce.Job: Job job_1523740562725_0003 completed successfully
2018-04-14 14:35:21,071 INFO mapreduce.Job: Counters: 53
  File System Counters
    FILE: Number of bytes read=278
    FILE: Number of bytes written=3299646
    FILE: Number of read operations=0
    FILE: Number of large read operations=0
    FILE: Number of write operations=0
    HDFS: Number of bytes read=1892597530
    HDFS: Number of bytes written=32
    HDFS: Number of read operations=50
    HDFS: Number of large read operations=0
    HDFS: Number of write operations=2
  Job Counters 
    Launched map tasks=15
    Launched reduce tasks=1
    Data-local map tasks=15
    Total time spent by all maps in occupied slots (ms)=367509
    Total time spent by all reduces in occupied slots (ms)=15084
    Total time spent by all map tasks (ms)=122503
    Total time spent by all reduce tasks (ms)=3771
    Total vcore-milliseconds taken by all map tasks=122503
    Total vcore-milliseconds taken by all reduce tasks=3771
    Total megabyte-milliseconds taken by all map tasks=376329216
    Total megabyte-milliseconds taken by all reduce tasks=15446016
  Map-Reduce Framework
    Map input records=4788976
    Map output records=4788976
    Map output bytes=71834640
    Map output materialized bytes=362
    Input split bytes=2520
    Combine input records=4788976
    Combine output records=16
    Reduce input groups=2
    Reduce shuffle bytes=362
    Reduce input records=16
    Reduce output records=2
    Spilled Records=32
    Shuffled Maps =15
    Failed Shuffles=0
    Merged Map outputs=15
    GC time elapsed (ms)=2213
    CPU time spent (ms)=121760
    Physical memory (bytes) snapshot=7511130112
    Virtual memory (bytes) snapshot=72005951488
    Total committed heap usage (bytes)=6518996992
    Peak Map Physical memory (bytes)=524804096
    Peak Map Virtual memory (bytes)=4434817024
    Peak Reduce Physical memory (bytes)=228110336
    Peak Reduce Virtual memory (bytes)=5555130368
  Shuffle Errors
    BAD_ID=0
    CONNECTION=0
    IO_ERROR=0
    WRONG_LENGTH=0
    WRONG_MAP=0
    WRONG_REDUCE=0
  File Input Format Counters 
    Bytes Read=1892595010
  File Output Format Counters 
    Bytes Written=32

ubuntu@ip-172-31-25-109:~/downloads$ fs -cat log-analyser/daily/part-r-00000
2017-09-30  9
2017-10-01  4788967

** Use parallel streaming to decrease running time **
    Total time spent by all map tasks (ms)=122503   ->  122760
    Total time spent by all reduce tasks (ms)=3771  ->  3286

However, the result is WRONG!
    
2018-04-14 14:43:02,740 INFO mapreduce.Job: Job job_1523740562725_0004 completed successfully
2018-04-14 14:43:02,834 INFO mapreduce.Job: Counters: 53
  File System Counters
    FILE: Number of bytes read=278
    FILE: Number of bytes written=3299678
    FILE: Number of read operations=0
    FILE: Number of large read operations=0
    FILE: Number of write operations=0
    HDFS: Number of bytes read=1892597530
    HDFS: Number of bytes written=32
    HDFS: Number of read operations=50
    HDFS: Number of large read operations=0
    HDFS: Number of write operations=2
  Job Counters 
    Launched map tasks=15
    Launched reduce tasks=1
    Data-local map tasks=15
    Total time spent by all maps in occupied slots (ms)=368280
    Total time spent by all reduces in occupied slots (ms)=13144
    Total time spent by all map tasks (ms)=122760
    Total time spent by all reduce tasks (ms)=3286
    Total vcore-milliseconds taken by all map tasks=122760
    Total vcore-milliseconds taken by all reduce tasks=3286
    Total megabyte-milliseconds taken by all map tasks=377118720
    Total megabyte-milliseconds taken by all reduce tasks=13459456
  Map-Reduce Framework
    Map input records=4788976
    Map output records=4788976
    Map output bytes=71834640
    Map output materialized bytes=362
    Input split bytes=2520
    Combine input records=4788976
    Combine output records=16
    Reduce input groups=2
    Reduce shuffle bytes=362
    Reduce input records=16
    Reduce output records=2
    Spilled Records=32
    Shuffled Maps =15
    Failed Shuffles=0
    Merged Map outputs=15
    GC time elapsed (ms)=2261
    CPU time spent (ms)=120660
    Physical memory (bytes) snapshot=7514349568
    Virtual memory (bytes) snapshot=72026554368
    Total committed heap usage (bytes)=6461325312
    Peak Map Physical memory (bytes)=512360448
    Peak Map Virtual memory (bytes)=4436369408
    Peak Reduce Physical memory (bytes)=227753984
    Peak Reduce Virtual memory (bytes)=5554651136
  Shuffle Errors
    BAD_ID=0
    CONNECTION=0
    IO_ERROR=0
    WRONG_LENGTH=0
    WRONG_MAP=0
    WRONG_REDUCE=0
  File Input Format Counters 
    Bytes Read=1892595010
  File Output Format Counters 
    Bytes Written=32
    
ubuntu@ip-172-31-25-109:~/downloads$ fs -cat log-analyser/daily/part-r-00000
2017-09-30  9
2017-10-01  5159400
    